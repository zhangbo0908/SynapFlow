# SynapFlow 产品需求文档 (PRD)

| 版本 | 日期 | 状态 | 编写人 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| v1.5 | 2026-02-12 | 迭代 | AI Assistant | 新增 [F17] 全键盘导航、[F18] 动态布局、[F19] XMind 视觉还原增强 |
| v1.4 | 2026-02-11 | 迭代 | AI Assistant | 新增 [F16] 节点拖拽重组功能需求 |
| v1.3 | 2026-02-11 | 迭代 | AI Assistant | 增强启动页定义，明确 .xmind 直接打开支持 |
| v1.2 | 2026-02-11 | 迭代 | AI Assistant | 明确全中文交互语言设计，规范默认文案 |
| v1.1 | 2026-02-10 | 迭代 | AI Assistant | 融入 UI 设计规范，深化视觉与交互定义 |
| v1.0 | 2026-02-10 | 草案 | AI Assistant | 初始版本，基于原始需求解构 |

---

## 1. 产品愿景 (Product Vision)
**SynapFlow** 旨在成为一款“如呼吸般自然”的思维导图设计工具。它不仅是信息的载体，更是灵感的助推器。通过极简的设计语言和强大的兼容性，让用户在处理复杂逻辑时能保持心流状态，实现从思考到视觉呈现的无缝转换。

## 2. 核心用户场景与痛点
- **场景 A：灵感快速捕捉**
  - **痛点**：工具操作复杂，快捷键不直观，导致灵感在寻找功能按钮时消失。
  - **任务 (JTBD)**：通过最少的点击或纯键盘操作，迅速搭建思维骨架。
- **场景 B：专业文档汇报**
  - **痛点**：默认样式单一，美化成本高。
  - **任务 (JTBD)**：一键应用专业模板，同时支持细节自定义，生成具有设计感的导图。
- **场景 C：跨平台协作/迁移**
  - **痛点**：历史资产锁定在特定软件（如 XMind），难以低成本迁移。
  - **任务 (JTBD)**：完美导入 XMind 文件，编辑后可无损导出。

## 3. 功能需求详细说明

### 3.1 核心引擎：数据兼容性
- **[F01] XMind 导入**：支持解析 `.xmind` 格式（特别是 XMind 2024/Zen 架构），完整还原节点层级、联系线、外框及基础图标。
- **[F02] XMind 导出**：支持将 SynapFlow 编辑的内容导出为 `.xmind` 格式，确保在其他工具中可继续编辑。
- **[F03] 基础导出**：支持导出为 PNG、PDF 及 Markdown。
- **[F12] 多画布 (Sheet) 系统**：
  - **交互栏 (Sheet Bar)**：位于窗口底部，高度 `32px`，背景色遵循 `ui-bg-panel`。
  - **标签页操作**：
    - **状态区分**：选中态高亮（上边框 `ui-accent-primary`），默认态透明。
    - **管理交互**：支持拖拽排序调整顺序，双击标签文本进行重命名。
    - **新增入口**：标签栏末尾常驻“+”按钮，点击创建新画布。
  - **信息展示**：右侧驻留当前画布的缩放比例及节点统计信息。
  - **默认命名**：新建画布自动命名为“画布 1”、“画布 2”，以此类推。

### 3.2 视觉系统：模板与布局
- **[F04] 风格模板库**：提供 5 套核心预设，覆盖主流场景。
  - **商务专业 (Professional Business)**：冷色调、直线条、几何边框，强调权威与冷静。
  - **清新薄荷 (Fresh Mint)**：马卡龙色系、圆角矩形，强调轻松与现代感。
  - **极简黑白 (Minimalist Mono)**：纯灰度、高对比度，强调内容至上与逻辑梳理。
  - **活力橙光 (Vibrant Energy)**：暖色调、粗线条、云朵形，强调热情与创造力。
  - **暗夜霓虹 (Dark Neon)**：深色模式专用，荧光配色、发光线条，强调科技沉浸感。
- **[F14] 布局引擎 (Layout Engine)**：
  - **固定间距策略**：
    - 水平间距：层级递减 (64px → 40px → 32px)。
    - 垂直间距：同级节点最小间距 16px，基于内容动态撑开。
- **[F06] 智能连线 (Smart Connectors)**：
  - **算法**：采用三阶贝塞尔曲线 (Cubic Bézier Curve) 渲染。
  - **形态**：起点为父节点右侧，终点为子节点左侧。
  - **视觉衰减**：线条粗细随层级递减 (3px → 1.5px)，颜色饱和度较节点降低 20%。

### 3.3 个性化定制
- **[F07] 全局样式控制**：
  - 引入 **设计令牌 (Design Tokens)** 系统，支持一键修改全图字体、色板。
  - 优先调用系统字体 (`Inter`, `-apple-system`, `PingFang SC`)。
- **[F08] 局部节点覆盖**：允许对特定节点设置独立的填充色、边框色、文字加粗等。
- **[F13] 界面外观模式**：
  - 基于语义化色彩令牌 (如 `ui-bg-app`, `ui-text-primary`) 实现。
  - **浅色模式**：`#FFFFFF` 背景，适应明亮办公环境。
  - **深色模式**：`#1E1E1E` 背景，降低夜间视觉疲劳。
  - 支持跟随系统自动切换。

### 3.4 交互与易用性
- **[F09] 沉浸式快捷键**：
  - `Enter`：添加同级节点 (并进入编辑模式)
  - `Tab`：添加子节点
  - `Space`：编辑当前节点
  - `Arrow Keys`：在节点间切换焦点
  - `Cmd/Ctrl + Z/Y`：撤销/重做
- **[F10] 渐进式操作提示**：
  - 底部状态栏显示当前可用快捷键提示。
  - 首次使用或空状态时，显示浮动教学层。
- **[F11] 全中文交互环境 (Native Chinese Support)**：
  - **界面语言**：
    - 菜单栏、工具栏、右键菜单、设置选项、报错信息等所有 UI 文本强制使用简体中文。
    - 严禁出现未经翻译的英文术语 (如 "Node", "Sheet", "Export" 需显示为 "节点", "画布", "导出")。
  - **默认内容文案 (Default Content)**：
    - 根节点默认文本：“中心主题”
    - 二级节点默认文本：“分支主题”
    - 三级及以下节点默认文本：“子主题”
    - 自由主题默认文本：“自由主题”
  - **中文输入优化**：
    - 确保输入法候选窗跟随光标，且不遮挡当前编辑的节点内容。
    - 支持中文标点符号的自动排版优化。
- **[F15] 启动页 (Welcome Screen)**：
  - **核心入口**：
    - **新建思维导图**：点击直接进入空画布编辑模式。
    - **打开文件**：点击唤起系统文件选择器。
      - 默认同时显示 `.synap` (原生) 和 `.xmind` (兼容) 两种格式。
      - **行为逻辑**：选中 `.xmind` 文件后，自动触发导入解析引擎，无缝转换为原生数据格式并打开，无需用户手动进行“导入”操作。
  - **最近文件**：展示最近打开过的文件记录，点击可快速重新打开。

- **[F16] 节点拖拽重组 (Drag & Drop Reorganization)**：
  - **操作方式**：用户按住节点（非根节点）可进行拖拽。
  - **视觉反馈**：
    - **拖拽中**：显示半透明的节点替身跟随鼠标。
    - **吸附提示**：当替身移动到其他节点（目标父节点）上方有效区域时，目标节点呈现高亮边框或背景色变化，提示可“吸附”。
  - **逻辑处理**：
    - 释放鼠标后，被拖拽节点（及其所有子节点）从原层级移除，并作为最后一个子节点挂载到目标节点下。
    - 触发自动布局计算，平滑过渡到新结构。
  - **约束**：根节点不可拖拽；禁止将节点拖拽到其自身的子孙节点上（避免循环引用）。

### 3.5 交互与体验增强 (Interaction & Experience)
- **[F17] 全键盘导航 (Full Keyboard Navigation)**：
  - **核心逻辑**：
    - `ArrowRight`：跳转到当前节点的第一个子节点（可视中心最近）。
    - `ArrowLeft`：跳转到父节点。
    - `ArrowUp`：跳转到上一个同级兄弟节点。
    - `ArrowDown`：跳转到下一个同级兄弟节点。
  - **特殊场景**：当节点处于编辑模式时，方向键用于光标移动，不触发节点切换。

- **[F18] 动态布局算法 (Dynamic Layout)**：
  - **间距策略**：
    - 水平间距随层级递减：Root -> L1 (`64px`), L1 -> L2 (`40px`), L2+ (`32px`)。
    - 垂直间距：基于子树高度动态计算，保证同级节点最小间距 `16px`。
  - **平滑过渡**：布局重排时，节点位置变化应用 `0.3s cubic-bezier` 过渡动画，避免视觉跳变。

- **[F19] XMind 视觉还原增强 (Enhanced XMind Parser)**：
  - **形状映射**：
    - 建立 `XMind Shape` <-> `SynapFlow Shape` 映射表。
    - 支持菱形 (`diamond`)、云朵 (`cloud`)、椭圆 (`ellipse`) 等特殊形状的解析与渲染。
  - **样式还原**：解析并应用线条样式（直线/曲线/折线）及节点边框样式。

### 3.6 交互微动效 (Micro-interactions)
- **节点伸缩**：折叠/展开子节点时，应用 `scale` 和 `opacity` 组合过渡 (200ms ease-out)。
- **自动对齐**：节点增删或拖拽时，同级节点平滑移动至新位置，避免瞬间跳变。
- **状态反馈**：Hover 状态下边框透明度变化，Selected 状态下边框加粗并高亮。

### 3.7 辅助功能 (Accessibility)
- **对比度合规**：确保所有预设主题的分支颜色在背景上的对比度符合 WCAG AA 标准。
- **全键盘导航**：支持仅通过键盘完成导图的创建、编辑、导航和管理，无需鼠标介入。

## 4. 设计原则 (Design Principles)
1.  **80/20 法则**：80% 的操作通过键盘完成，20% 的高级配置隐藏在侧边栏中。
2.  **秩序与流动**：通过严格的间距与平滑的曲线，在视觉上构建逻辑的秩序感与思维的流动感。
3.  **克制与隐藏**：默认界面极简，仅在必要时渐进式披露复杂功能。

## 5. 待办任务与迭代计划 (MVP)
- **第一阶段 (v1.0)**：实现核心绘图引擎 (含贝塞尔曲线)、XMind 导入、基础快捷键及 3 套精选模板 (商务/清新/黑白)。
- **第二阶段 (v1.1)**：完善 Sheet 系统、微动效实现、深色模式适配 (暗夜霓虹主题)、XMind 导出。
- **第三阶段 (v1.2)**：高级形状扩展、云端存储预研、操作提示系统。

## 6. 成功衡量指标
- **导入成功率**：XMind 文件解析无报错比例 > 98%。
- **视觉还原度**：用户评价 SynapFlow 默认样式的美观度评分 (NPS)。
- **操作效率**：用户完成 20 个节点创建的平均耗时。
